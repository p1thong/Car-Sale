@page "{customerId:int}"
@model ASM1.WebMVC.Pages.CustomerService.CustomerProfileModel
@{
    ViewData["Title"] = "Hồ Sơ Khách Hàng";
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="fas fa-user-circle text-primary"></i> Hồ Sơ Khách Hàng</h2>
        <a href="/CustomerService/TestDrives" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left"></i> Quay Lại
        </a>
    </div>

    @if (Model.Customer == null)
    {
        <div class="alert alert-danger">Không tìm thấy thông tin khách hàng.</div>
    }
    else
    {
        <div class="row">
            <!-- Customer Info Card -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-user"></i> Thông Tin Cá Nhân</h5>
                    </div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <div class="avatar-circle bg-primary text-white mx-auto">
                                <i class="fas fa-user fa-3x"></i>
                            </div>
                            <h4 class="mt-3">@Model.Customer.FullName</h4>
                        </div>
                        <hr>
                        <p><i class="fas fa-envelope text-primary"></i> <strong>Email:</strong> @Model.Customer.Email</p>
                        <p><i class="fas fa-phone text-primary"></i> <strong>Số Điện Thoại:</strong> @Model.Customer.Phone</p>
                        @if (Model.Customer.Birthday.HasValue)
                        {
                            <p><i class="fas fa-birthday-cake text-primary"></i> <strong>Ngày Sinh:</strong> @Model.Customer.Birthday.Value.ToString("dd/MM/yyyy")</p>
                        }
                        <p><i class="fas fa-building text-primary"></i> <strong>Dealer:</strong> @Model.Customer.Dealer?.FullName</p>
                    </div>
                </div>
            </div>

            <!-- Statistics Card -->
            <div class="col-md-6 mb-4">
                <div class="card shadow-sm h-100">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Thống Kê</h5>
                    </div>
                    <div class="card-body">
                        <div class="row text-center">
                            <div class="col-6 mb-3">
                                <div class="stat-box border rounded p-3">
                                    <h2 class="text-primary mb-0">@Model.OrderCount</h2>
                                    <small class="text-muted">Đơn Hàng</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-box border rounded p-3">
                                    <h2 class="text-success mb-0">@Model.TestDriveCount</h2>
                                    <small class="text-muted">Lịch Lái Thử</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-box border rounded p-3">
                                    <h2 class="text-warning mb-0">@Model.FeedbackCount</h2>
                                    <small class="text-muted">Phản Hồi</small>
                                </div>
                            </div>
                            <div class="col-6 mb-3">
                                <div class="stat-box border rounded p-3">
                                    <h2 class="text-danger mb-0">@Model.TotalSpent.ToString("N0")</h2>
                                    <small class="text-muted">VNĐ</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Section -->
            @if (Model.Orders.Any())
            {
                <div class="col-md-12 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0"><i class="fas fa-shopping-cart"></i> Đơn Hàng Gần Đây</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Mã ĐH</th>
                                            <th>Xe</th>
                                            <th>Ngày</th>
                                            <th>Trạng Thái</th>
                                            <th>Giá Trị</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var order in Model.Orders.Take(5))
                                        {
                                            <tr>
                                                <td><strong>#@order.OrderId</strong></td>
                                                <td>@order.Variant?.VehicleModel?.Name</td>
                                                <td>@order.OrderDate?.ToString("dd/MM/yyyy")</td>
                                                <td>
                                                    <span class="badge bg-@(order.Status == "Completed" ? "success" : order.Status == "Confirmed" ? "info" : "warning")">
                                                        @order.Status
                                                    </span>
                                                </td>
                                                <td>@order.Variant?.Price?.ToString("N0") VNĐ</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            }

            <!-- Test Drives Section -->
            @if (Model.TestDrives.Any())
            {
                <div class="col-md-12 mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0"><i class="fas fa-calendar-check"></i> Lịch Lái Thử Gần Đây</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Mã</th>
                                            <th>Xe</th>
                                            <th>Ngày</th>
                                            <th>Giờ</th>
                                            <th>Trạng Thái</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var testDrive in Model.TestDrives.Take(5))
                                        {
                                            <tr>
                                                <td><strong>#@testDrive.TestDriveId</strong></td>
                                                <td>@testDrive.Variant?.VehicleModel?.Name</td>
                                                <td>@testDrive.ScheduledDate?.ToString("dd/MM/yyyy")</td>
                                                <td>@testDrive.ScheduledTime?.ToString("HH:mm")</td>
                                                <td>
                                                    <span class="badge bg-@(testDrive.Status == "Completed" ? "success" : testDrive.Status == "Confirmed" ? "info" : testDrive.Status == "Cancelled" ? "danger" : "warning")">
                                                        @testDrive.Status
                                                    </span>
                                                </td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>

@section Styles {
    <style>
        .avatar-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .stat-box {
            transition: all 0.3s;
        }
        .stat-box:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
    </style>
}
