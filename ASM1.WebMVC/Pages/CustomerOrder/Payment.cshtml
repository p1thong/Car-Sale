@page "{orderId:int?}"
@model ASM1.WebMVC.Pages.CustomerOrder.PaymentModel
@{
	ViewData["Title"] = "Thanh toán đơn hàng";
}

<div class="container mt-4">
	<!-- Header -->
	<div class="d-flex align-items-center mb-4">
		<a asp-page="/Customer/OrderDetail" asp-route-id="@Model.OrderData?.OrderId" class="btn btn-outline-secondary me-3">
			<i class="fas fa-arrow-left"></i>
		</a>
		<h2 class="mb-0">
			<i class="fas fa-credit-card text-success me-2"></i>
			Thanh toán đơn hàng #@Model.OrderData?.OrderId
		</h2>
	</div>

	<div class="row">
		<div class="col-12">
			@if (TempData["SuccessMessage"] != null)
			{
				<div class="alert alert-success">@TempData["SuccessMessage"]</div>
			}
			@if (TempData["ErrorMessage"] != null)
			{
				<div class="alert alert-danger">@TempData["ErrorMessage"]</div>
			}
		</div>

		<!-- LEFT: Order Summary -->
		<div class="col-lg-7 mb-4">
			<div class="card shadow-sm">
				<div class="card-header bg-primary text-white">
					<h5 class="mb-0">
						<i class="fas fa-receipt me-2"></i> Tóm tắt đơn hàng
					</h5>
				</div>
				<div class="card-body">
					<div class="row">
						<div class="col-md-4">
							@if (!string.IsNullOrEmpty(Model.OrderData?.Variant?.VehicleModel?.ImageUrl))
							{
								<img src="@Model.OrderData.Variant.VehicleModel.ImageUrl"
									 alt="@Model.OrderData.Variant.VehicleModel.ModelName"
									 class="img-fluid rounded shadow-sm"
									 style="height: 150px; object-fit: cover;">
							}
							else
							{
								<div class="bg-light d-flex align-items-center justify-content-center rounded" style="height: 150px;">
									<i class="fas fa-car fa-3x text-muted"></i>
								</div>
							}
						</div>
						<div class="col-md-8">
							<h4 class="text-primary fw-bold">@Model.OrderData?.Variant?.VehicleModel?.ModelName</h4>
							<p class="text-muted mb-2">
								@Model.OrderData?.Variant?.VehicleModel?.Manufacturer?.Name
							</p>
							<div class="row">
								<div class="col-6">
									<strong>Phiên bản:</strong> @Model.OrderData?.Variant?.Version<br>
									<strong>Màu sắc:</strong> @Model.OrderData?.Variant?.Color
								</div>
								<div class="col-6">
									<strong>Ngày đặt:</strong> @Model.OrderData?.OrderDate?.ToString("dd/MM/yyyy")<br>
									<strong>Số lượng:</strong> @Model.OrderData?.Quantity xe
								</div>
							</div>
						</div>
					</div>
					<hr />
					<div class="d-flex justify-content-between align-items-center">
						<span class="fs-5 fw-bold">Tổng tiền đơn hàng:</span>
						<span class="fs-4 text-success fw-bold">
							@Model.OrderTotal.ToString("C0", new System.Globalization.CultureInfo("en-US"))
						</span>
					</div>
				</div>
			</div>
		</div>

		<!-- RIGHT: Payment Form -->
		<div class="col-lg-5">
			<div class="card shadow-lg border-success">
				<div class="card-header bg-success text-white text-center">
					<h4 class="mb-0">
						<i class="fas fa-money-bill-wave fa-lg me-2"></i> Thanh Toán Bằng Tiền Mặt
					</h4>
				</div>
				<div class="card-body">
					<div class="text-center mb-4">
						<div class="bg-light d-inline-flex align-items-center justify-content-center rounded-circle shadow-sm"
							 style="width: 90px; height: 90px;">
							<i class="fas fa-hand-holding-usd fa-3x text-success"></i>
						</div>
						<h5 class="mt-3 text-muted">Thanh toán toàn bộ giá trị xe</h5>
					</div>

					<form method="post">
						@Html.AntiForgeryToken()
						<input type="hidden" asp-for="OrderId" />
						<input type="hidden" asp-for="PaymentMethod" value="Cash" />

						<div class="mb-3">
							<label asp-for="Amount" class="form-label fw-bold">Số tiền cần thanh toán</label>
							<div class="input-group input-group-lg">
								<span class="input-group-text bg-success text-white fw-bold">$</span>
								<input asp-for="Amount" type="number" class="form-control form-control-lg text-end fw-bold"
									   value="@(Convert.ToInt32(Model.RemainingBalance))" readonly
									   style="background-color: #f8f9fa;" />
							</div>
							<small class="text-muted">Bạn cần thanh toán toàn bộ số tiền còn lại bằng tiền mặt.</small>
						</div>

						<div class="d-grid gap-2 mt-4">
							<button type="submit" class="btn btn-success btn-lg">
								<i class="fas fa-check-circle me-2"></i> Xác nhận thanh toán
							</button>
							<a asp-page="/Customer/OrderDetail" asp-route-id="@Model.OrderData?.OrderId"
							   class="btn btn-outline-secondary btn-lg">
								<i class="fas fa-times me-2"></i> Hủy bỏ
							</a>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
}
